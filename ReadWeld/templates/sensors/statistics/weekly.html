{% extends "sensors/statistics/base.html" %}
{% from "_formhelpers.html" import display_statistics %}

{% set data_for_weekly_statistics = statistics %}
{% set daily_reports                        = data_for_weekly_statistics.daily_reports %}
{% set total_work_and_idle_time             = data_for_weekly_statistics.total_work_and_idle_time %}
{% set total_spent_wire_and_gas             = data_for_weekly_statistics.total_spent_wire_and_gas %}
{% set best_daily_report                    = data_for_weekly_statistics.best_daily_report %}
{% set best_worker                          = data_for_weekly_statistics.best_worker %}





{% block top_part %}
    <div class="stat_details__col">
        {% set start_date = daily_reports[0].date %}
        {% set end_date = daily_reports[-1].date %}
        <h2 class="stat_title">
            –ù–µ–¥–µ–ª—è —Å 
            <span>{{start_date.day}}/{{start_date.month}}/{{start_date.year}}</span>
            –ø–æ
            <span>{{end_date.day}}/{{end_date.month}}/{{end_date.year}}</span>
        </h2>
        {% set data_for_daily_statistics_template1 = {
            "expended_wire": {
                "title": "–ò–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ –ø—Ä–æ–≤–æ–ª–∫–∏",
                "value": total_spent_wire_and_gas.0,
                "ms": "–∫–≥" 
            },
            "expended_gas": {
                "title": "–ò–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ –≥–∞–∑–∞",
                "value": total_spent_wire_and_gas.1,
                "ms": "–ª"
            },
            "total_work": {
                "title": "–í—Ä–µ–º—è —Ä–∞–±–æ—Ç–∞",
                "value": working_hours(total_work_and_idle_time.0),
                "ms": ""
            },
            "total_idle": {
                "title": "–í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è",
                "value": working_hours(total_work_and_idle_time.1),
                "ms": ""
            },
            "best_daily_report": {
                "title": "–õ—É—á—à–∏–π –¥–µ–Ω—å",
                "value": date_on_day_of_week(best_daily_report.date.year, best_daily_report.date.month, best_daily_report.date.day),
                "ms": ""
            },
            "best_worker": {
                "title": "–õ—É—á—à–∏–π —Å–≤–∞—Ä—â–∏–∫",
                "value": best_worker.first_name ~ " " ~ best_worker.second_name ~" " ~ " (" ~ best_worker.phone ~")" if best_worker else "–ü–µ–Ω–Ω–∏–≤–∞–π–∑ ü§°",
                "ms": "",
                "href": url_for('users.edit_welder', id=best_worker.id) if best_worker else None
            },
            "choose-week": {
                "title": "–ù–µ–¥–µ–ª—è",
                "value": '<input type="week" name="choose-week" id="choose-week" min="2023-W1" max="2030-W1" value="" required>',
                "ms": "",
            },
            "choose-": {
                "title": "",
                "value": '<input type="submit" id="refresh-button" value="–û–±–Ω–æ–≤–∏—Ç—å">',
                "ms": ""
            }
        }%}
        

        {% for key, value in data_for_daily_statistics_template1.items() %}
            <div class="stat_detail">
                {{display_statistics(value)}}
            </div>
        {% endfor %}
        
    </div>
{% endblock %}


{% block graphics %}
    <div class="graphic graphic_sm">
        <div id='for-data'  class="stat_details__col"></div>
    </div>
    
    {% for i in range(3) %}
        <div class="graphic graphic_sm">
            <canvas class="weekly-charts"></canvas>
        </div>
    {% endfor %}
{% endblock %}


{% block statistics_javascript %}
    <script src="/static/js/sensors/statistics/weekly.js"></script>
    <script>
        pageHandle.data–°ollection({{ python_object_to_json(daily_reports) |safe }}).creatAuxiliaryCharts(); 
    </script>
{% endblock %}
